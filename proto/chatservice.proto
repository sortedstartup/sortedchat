syntax = "proto3";

package sortedchat;

option go_package = "sortedstartup/chatservice/proto";


service SortedChat {
    rpc Chat(ChatRequest) returns (stream ChatResponse);
    rpc GenerateChatName(GenerateChatNameRequest) returns (GenerateChatNameResponse);
    rpc GetHistory(GetHistoryRequest) returns (GetHistoryResponse);
    rpc GetChatList(GetChatListRequest) returns (GetChatListResponse);
    rpc CreateChat(CreateChatRequest) returns (CreateChatResponse);
    rpc ListModel(ListModelsRequest) returns (ListModelsResponse);
    rpc SearchChat(ChatSearchRequest) returns (ChatSearchResponse);

    rpc CreateProject(CreateProjectRequest) returns (CreateProjectResponse);
    rpc GetProjects(GetProjectsRequest) returns (GetProjectsResponse);
    rpc ListDocuments(ListDocumentsRequest) returns(ListDocumentsResponse);
    rpc SubmitGenerateEmbeddingsJob(GenerateEmbeddingRequest) returns (GenerateEmbeddingResponse);

    rpc BranchAChat(BranchAChatRequest) returns (BranchAChatResponse);
    rpc InnerChatList(InnerChatListRequest) returns (InnerChatListResponse);
}

service SettingService {
    rpc GetSetting(GetSettingRequest) returns (GetSettingResponse);
    rpc SetSetting(SetSettingRequest) returns (SetSettingResponse);
}

message Settings {
   string OPENAI_API_KEY = 1;
   string OPENAI_API_URL = 2;
   string OLLAMA_URL = 3;
}

message GetSettingRequest {}

message GetSettingResponse {
    Settings settings = 1;
}

message SetSettingRequest {
    Settings settings = 1;
}

message SetSettingResponse {
    string message = 1;
}


message CreateChatRequest {
  string name = 1;
  string project_id = 2;
}

message CreateChatResponse {
  string message = 1;
  string chat_id = 2;
}

message ChatRequest {
    string text = 1;
    string chatId = 2;
    string model = 3;
    string project_id = 4;
}

message ChatResponse {
  oneof response {
    string text = 1;
    MessageSummary summary = 2;
  }
}

message MessageSummary {
  string message_id = 1;
}

message GetHistoryRequest {
  string chatId = 1;
}

message GetHistoryResponse {
  repeated ChatMessage history = 1;
}

message ChatMessage {
  string role = 1;
  string content = 2;
  string message_id = 3;
}

message GetChatListRequest {
  string project_id = 1;
}

message GetChatListResponse {
  repeated ChatInfo chats = 1;
}

message ChatInfo {
  string chatId = 1;
  string name = 2;
}

message ModelListInfo {
  string id = 1;
  string label = 2;
  string provider = 3;
  string url = 4;
  float input_token_cost = 5;
  float output_token_cost = 6;
}

message ListModelsRequest {}

message ListModelsResponse {
  repeated ModelListInfo models = 1;
}

message ChatSearchRequest {
  string query = 1;
}

message SearchResult {
  string chat_name = 1;
  string chat_id = 2;
  string matched_text = 3;
}

message ChatSearchResponse {
  string query = 1;
  repeated SearchResult results = 2;
}

message CreateProjectRequest {
  string name = 1;
  string description = 2;
  string additional_data = 3; 
}

message CreateProjectResponse {
  string message = 1;
  string project_id = 2;
}

message GetProjectsRequest {}

message GetProjectsResponse {
  repeated Project projects = 1;
}

message Project {
  string id = 1;
  string name = 2;
  string description = 3;
  string additional_data = 4;
  string created_at = 5;
  string updated_at = 6;
}

message ListDocumentsRequest {
  string project_id = 1;
}

message ListDocumentsResponse {
  repeated Document documents = 1;
}

message Document {
  int64 id = 1;
  string project_id = 2;
  string docs_id = 3;
  string file_name = 4;
  string created_at = 5;
  string updated_at = 6;
  Embedding_Status embedding_status=7;
}

enum Embedding_Status {
  STATUS_QUEUED = 0;
  STATUS_IN_PROGRESS = 1;
  STATUS_ERROR = 2;
  STATUS_SUCCESS = 3;
}

message GenerateEmbeddingRequest {
  string project_id = 1;
}

message GenerateEmbeddingResponse {
  string message = 1;
}

message GenerateChatNameRequest{
  string chat_id = 1;
  string message = 2; //first message in new chat
  string model = 3;
}

message GenerateChatNameResponse {
  string chat_name = 1;
}

message BranchAChatRequest {
  string source_chat_id = 1;           // Chat to branch from
  string branch_from_message_id = 2;    // Message ID where branch starts
  string branch_name = 3;               // Optional name for new branch
  string project_id = 4;                // Project context
}


message BranchAChatResponse {
  string message = 1;                   // Success/error message
  string new_chat_id = 2;              // ID of newly created branch
}

message InnerChatListRequest {
  string chat_id = 1;
}

message InnerChatListResponse {
  repeated ChatInfo inner_chat_list = 1;
}